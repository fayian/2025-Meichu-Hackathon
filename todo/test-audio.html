<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Test - MX Creative Console</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0d1117;
            color: #f0f6fc;
            padding: 2rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .test-container {
            background: rgba(33, 38, 45, 0.8);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid #30363d;
        }
        
        h1 {
            color: #4ecdc4;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .test-button {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 1rem 0;
            background: #4ecdc4;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #45b7ae;
            transform: translateY(-2px);
        }
        
        .status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            text-align: center;
        }
        
        .status.success {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
        }
        
        .status.error {
            background: rgba(255, 82, 82, 0.2);
            border: 1px solid #ff5252;
        }
        
        .info {
            background: rgba(33, 38, 45, 0.8);
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            color: #8b949e;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🍅 番茄鐘音效測試</h1>
        
        <div class="info">
            <p><strong>使用說明：</strong></p>
            <ul>
                <li>點擊各個按鈕測試不同的音效</li>
                <li>確保瀏覽器允許播放音效</li>
                <li>如果沒有聲音，請檢查音量設定</li>
                <li>現代瀏覽器需要用戶交互後才能播放音效</li>
            </ul>
        </div>
        
        <button class="test-button" onclick="testSound('complete')">
            🎉 測試完成音效 (3聲長音)
        </button>
        
        <button class="test-button" onclick="testSound('start')">
            ▶️ 測試開始音效
        </button>
        
        <button class="test-button" onclick="testSound('pause')">
            ⏸️ 測試暫停音效
        </button>
        
        <button class="test-button" onclick="testBrowserNotification()">
            🔔 測試瀏覽器通知
        </button>
        
        <button class="test-button" onclick="requestPermissions()">
            🔓 請求通知權限
        </button>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div id="timer-test" style="margin-top: 2rem; text-align: center;">
            <h3>快速計時器測試 (5秒)</h3>
            <button class="test-button" onclick="startQuickTimer()">
                ⏱️ 開始5秒測試計時器
            </button>
            <div id="timer-display" style="font-size: 2rem; margin: 1rem 0; color: #4ecdc4;"></div>
        </div>
    </div>

    <script>
        // 音效播放函數 (複製自主應用程式)
        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const volume = 0.1;
                
                let frequency, duration, pattern;
                
                switch(type) {
                    case 'complete':
                        frequency = 800;
                        duration = 0.5;
                        pattern = [0, 0.6, 1.2];
                        break;
                    case 'start':
                        frequency = 600;
                        duration = 0.3;
                        pattern = [0];
                        break;
                    case 'pause':
                        frequency = 400;
                        duration = 0.2;
                        pattern = [0];
                        break;
                    default:
                        frequency = 500;
                        duration = 0.2;
                        pattern = [0];
                }
                
                pattern.forEach((delay, index) => {
                    setTimeout(() => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        
                        osc.frequency.setValueAtTime(frequency, audioContext.currentTime);
                        gain.gain.setValueAtTime(0, audioContext.currentTime);
                        gain.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                        gain.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration);
                        
                        osc.start(audioContext.currentTime);
                        osc.stop(audioContext.currentTime + duration);
                    }, delay * 1000);
                });
                
                showStatus(`音效播放成功: ${type}`, 'success');
            } catch (error) {
                console.error('音效播放失敗:', error);
                showStatus(`音效播放失敗: ${error.message}`, 'error');
            }
        }
        
        function testSound(type) {
            playSound(type);
        }
        
        function testBrowserNotification() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('🍅 測試通知', {
                        body: '這是一個測試通知，確認瀏覽器通知功能正常！',
                        icon: '/favicon.ico'
                    });
                    showStatus('通知發送成功！', 'success');
                } else {
                    showStatus('請先允許通知權限', 'error');
                }
            } else {
                showStatus('瀏覽器不支援通知功能', 'error');
            }
        }
        
        function requestPermissions() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showStatus('通知權限已獲得！', 'success');
                    } else {
                        showStatus('通知權限被拒絕', 'error');
                    }
                });
            } else {
                showStatus('瀏覽器不支援通知功能', 'error');
            }
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        // 快速計時器測試
        let testTimer = null;
        
        function startQuickTimer() {
            if (testTimer) {
                clearInterval(testTimer);
            }
            
            let remaining = 5;
            const display = document.getElementById('timer-display');
            
            display.textContent = `${remaining}秒`;
            showStatus('5秒測試計時器開始', 'success');
            
            testTimer = setInterval(() => {
                remaining--;
                display.textContent = `${remaining}秒`;
                
                if (remaining <= 0) {
                    clearInterval(testTimer);
                    display.textContent = '完成！';
                    playSound('complete');
                    testBrowserNotification();
                    showStatus('測試計時器完成！音效和通知已觸發', 'success');
                    
                    setTimeout(() => {
                        display.textContent = '';
                    }, 3000);
                }
            }, 1000);
        }
        
        // 頁面載入時顯示系統資訊
        window.addEventListener('load', () => {
            console.log('音效測試頁面載入完成');
            
            // 檢查支援功能
            const features = [];
            if (window.AudioContext || window.webkitAudioContext) {
                features.push('✅ Web Audio API');
            } else {
                features.push('❌ Web Audio API');
            }
            
            if ('Notification' in window) {
                features.push(`✅ 瀏覽器通知 (${Notification.permission})`);
            } else {
                features.push('❌ 瀏覽器通知');
            }
            
            console.log('支援功能:', features.join(', '));
        });
    </script>
</body>
</html>